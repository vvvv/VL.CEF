<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net6.0</TargetFramework>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <Platforms>x64;x86</Platforms>
    <SelfContained>false</SelfContained>
    
    <!-- Disable pack warning about dlls being in wrong folder - this package delivers the whole renderer app -->
    <NoWarn>NU5128;NU5100</NoWarn>
  </PropertyGroup>
  
  <!-- Manually include cef dlls and resources in nu packages and copy them to build directory -->
  <ItemGroup>
    <None Include="$(SolutionDir)deps\cef\**">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <LinkBase>renderer</LinkBase>
    </None>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\deps\cef_glue\CefGlue\CefGlue.csproj" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <None Update="buildTransitive\*" Pack="true" PackagePath="" />
  </ItemGroup>

  <PropertyGroup>
    <TargetsForTfmSpecificBuildOutput>$(TargetsForTfmSpecificBuildOutput);CopyProjectReferencesToPackage</TargetsForTfmSpecificBuildOutput>
  </PropertyGroup>

  <Target Name="CopyProjectReferencesToPackage" DependsOnTargets="ResolveReferences">
    <ItemGroup>
      <BuildOutputInPackage Include="@(ReferenceCopyLocalPaths->WithMetadataValue('ReferenceSourceTarget', 'ProjectReference'))" />
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);GetCustomContentPackageFiles</TargetsForTfmSpecificContentInPackage>
  </PropertyGroup>

  <Target Name="GetCustomContentPackageFiles" DependsOnTargets="ResolveAssemblyReferences;BuiltProjectOutputGroup;GetCopyToOutputDirectoryItems">
    <ItemGroup>
      <!-- The dll of this project -->
      <TfmSpecificPackageFile Include="@(BuiltProjectOutputGroupOutput)">
        <PackagePath>renderer-managed</PackagePath>
      </TfmSpecificPackageFile>
      <!-- The referenced dlls of this project -->
      <TfmSpecificPackageFile Include="@(ReferenceCopyLocalPaths)">
        <PackagePath>renderer-managed</PackagePath>
      </TfmSpecificPackageFile>
      <!-- The apphost.exe used as exe for this project -->
      <TfmSpecificPackageFile Include="@(AllItemsFullPathWithTargetPath)" Condition="$([System.String]::new('%(AllItemsFullPathWithTargetPath.TargetPath)').StartsWith('VL.CEF.Renderer'))">
        <PackagePath>renderer-managed\%(AllItemsFullPathWithTargetPath.TargetPath)</PackagePath>
      </TfmSpecificPackageFile>
      <!-- The native dlls -->
      <TfmSpecificPackageFile Include="$(SolutionDir)deps\cef\**">
        <PackagePath>renderer-native</PackagePath>
      </TfmSpecificPackageFile>
    </ItemGroup>
  </Target>

</Project>
